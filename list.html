<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor List</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .checkout-button {
            cursor: pointer;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h2>Visitor List</h2>
    <table id="visitorTable">
        <thead>
            <tr>
                <th>Visitor Date</th>
                <th>Visitor Name</th>
                <th>Visitor From</th>
                <th>Visitor Host</th>
                <th>Visitor Needs</th>
                <th>Number of Visitors</th>
                <th>Vehicle</th>
                <th>Visitor Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Visitor rows will be appended here -->
        </tbody>
    </table>

    <script>
        // Fetch the visitor list from the API
        function fetchVisitorList() {
            fetch('http://127.0.0.1:8000/api/visitor')
                .then(response => response.json())
                .then(data => {
                    // Extract the data array from the response
                    if (data.success && Array.isArray(data.data)) {
                        data = data.data;
                    } else {
                        console.error('Error: Expected an array but received:', data);
                        return;
                    }

                    const visitorTableBody = document.getElementById('visitorTable').getElementsByTagName('tbody')[0];
                    visitorTableBody.innerHTML = '';

                    data.forEach(visitor => {
                        const row = visitorTableBody.insertRow();

                        const cellDate = row.insertCell(0);
                        const cellName = row.insertCell(1);
                        const cellFrom = row.insertCell(2);
                        const cellHost = row.insertCell(3);
                        const cellNeeds = row.insertCell(4);
                        const cellAmount = row.insertCell(5);
                        const cellVehicle = row.insertCell(6);
                        const cellImage = row.insertCell(7);
                        const cellActions = row.insertCell(8);

                        cellDate.textContent = visitor.visitor_date;
                        cellName.textContent = visitor.visitor_name;
                        cellFrom.textContent = visitor.visitor_from;
                        cellHost.textContent = visitor.visitor_host;
                        cellNeeds.textContent = visitor.visitor_needs;
                        cellAmount.textContent = visitor.visitor_amount;
                        cellVehicle.textContent = visitor.visitor_vehicle;

                        const img = document.createElement('img');
                        img.src = `http://127.0.0.1:8000/storage/${visitor.visitor_img}`;
                        img.width = 100;
                        cellImage.appendChild(img);

                        // Add checkout/update button
                        const checkoutButton = document.createElement('button');
                        checkoutButton.className = 'checkout-button';
                        checkoutButton.textContent = 'Checkout';
                        checkoutButton.onclick = () => updateCheckout(visitor.visitor_id);
                        cellActions.appendChild(checkoutButton);
                    });
                })
                .catch(error => {
                    console.error('Error fetching visitor list:', error);
                });
        }

        // Function to update the checkout status of a visitor
        function updateCheckout(id) {
            fetch(`http://127.0.0.1:8000/checkout/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ checked_out: true })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Checkout updated successfully!');
                        fetchVisitorList(); // Refresh the visitor list
                    } else {
                        console.error('Error updating checkout:', data);
                    }
                })
                .catch(error => {
                    console.error('Error updating checkout:', error);
                });
        }

        // Fetch the visitor list when the page loads
        window.onload = fetchVisitorList;
    </script>
</body>
</html>